pipeline {
    agent any


    environment {
        MONGO_URI = credentials('mongodb://localhost:27017/')  // Configura en Jenkins
        DATABASE_NAME = 'middleware_test'
    }

    stages {
        stage('Preparar entorno') {
            steps {
                sh 'python3 -m venv venv'
                sh './venv/bin/pip install -r requirements.txt'
            }
        }

        stage('Ejecutar extracción') {
            steps {
                sh './venv/bin/python extract_loans.py'
            }
        }
    }

    post {
        success {
            echo "✅ Reporte generado y guardado en el workspace"
        }
        failure {
            echo "❌ Error en la extracción"
        }
    }
}
